Date: 2026-01-18

Important Links

 - MatrixOS – the swarm agents and supporting files (install to server or use Phoenix’s railgun):
   https://github.com/matrixswarm/matrixos

 - Phoenix – the swarm’s GUI:  
   https://github.com/matrixswarm/phoenix

 - Contact for full Sora access/integration:
   swarm@matrixswarm.com

⚠️ It’s advised to update Phoenix and MatrixOS simultaneously.

COMMIT: MatrixSwarm – Email_Send – Snake-Tail Edition
Stand-alone / Group Perimeter Lockdown for Ingress and Egress Agents

This commit introduces a consistent lockdown control system across all Matrix ingress and egress agents.
Each agent (matrix_websocket, matrix_https, matrix_email) can now independently or collectively toggle packet acceptance through a unified swarm command interface.

The lockdown framework supports both temporary timed lockdowns and indefinite shutdowns, including auto-reopen logic and visual confirmations in the GUI perimeter panels.


## Technical Overview
 
 Core Concept

Each agent now exposes three public control endpoints:

1. cmd_status — Reports current perimeter state.

2. cmd_toggle_perimeter — External command handler used by GUI panels and swarm control nodes.

3. toggle_perimeter() — Local logic that directly mutates the lockdown state.

All three rely on two shared configuration keys:

 - self.lockdown_state  # bool — True = perimeter closed, False = accepting packets
 - self.lockdown_time   # int  — seconds before auto reopen (0 = indefinite)

When lockdown_state is True, packet ingress (email fetch, HTTPS, or WebSocket handling) is completely suspended until the agent reopens automatically or receives an override command through another active transport.

## Runtime Logic

Worker-level enforcement

Each agent’s worker() loop checks perimeter state before processing any external input:

if self.lockdown_state and self.lockdown_time > 0:
    now = int(time.time())
    if now >= self.lockdown_expires:
        self.log("[LOCKDOWN] Time expired. Reopening perimeter.")
        self.toggle_perimeter(False, 0)

If lockdown is active, the agent logs and rejects all external packets:

if self.lockdown_state:
    self.log("[MATRIX-EMAIL][BLOCKED] Packet Processing is Off.")
    return

Auto-reopen behavior

When a timed lockdown expires, the agent reopens automatically by resetting:

   self.lockdown_state = False
   self.lockdown_expires = 0

This ensures self-healing behavior after a defined offline window.

## Command Flow

1. GUI Panel → Swarm Command

The user toggles the perimeter using one of the GUI perimeter panels (matrix_websocket_panel, matrix_https_panel, matrix_email_panel).
Each panel emits:

{
  "handler": "cmd_service_request",
  "content": {
    "service": "matrix_email.toggle_perimeter",
    "payload": {
      "lockdown_state": 1,
      "lockdown_time": 600,
      "session_id": "...",
      "return_handler": "matrix_email_panel.perimeter_ack"
    }
  }
}

If the user sets lockdown_time = 0, a confirmation dialog warns:

  "You are setting the lockdown time to 0 (indefinite).
  This will completely disable packet processing until reopened through another transport such as matrix_https or matrix_email."

2. Agent Command Handlers

cmd_toggle_perimeter()

 - Receives lockdown_state and lockdown_time

 - Invokes toggle_perimeter()

 - Replies with current perimeter info through an encrypted crypto_reply() message

toggle_perimeter()

 - Updates internal flags

 - Calculates lockdown_expires as:

 self.lockdown_expires = int(time.time()) + lockdown_time if lockdown_time > 0 else 0

 - Persists state in memory (no restart required)

cmd_status()

 - Returns structured payload with:

{
  "lockdown_state": "Lockdown" | "Open",
  "lockdown_time": <seconds>,
  "lockdown_expires": "<bool: has expiry>"
}

## Group Behavior (Swarm-wide Lockdown)

When a perimeter command is sent to the Hive role (hive.toggle_perimeter), it propagates the same payload to every agent marked as a perimeter node.
This allows centralized lockdown of all ingress points (HTTPS, WebSocket, Email) with a single command.

Each agent acts autonomously on receipt:

 - If lockdown_state=True, stop accepting inbound packets.

 - If lockdown_time>0, schedule auto-reopen.

 - Report acknowledgment back to the initiating panel.

This maintains perfect synchronization without shared state dependencies. 

## Design Goals Achieved

Unified Interface: All ingress agents obey identical command and reply structures.

 * Safe Operation: Confirmation dialogs prevent accidental permanent lockouts.

 * Autonomous Recovery: Timed lockdowns automatically reopen after expiry.

 * Swarm Coordination: Commands can target one agent or the entire perimeter group.

 * Minimal Surface Change: Only two config keys (lockdown_state, lockdown_time) required; backward compatible.

## Example Log Flow

[LOCKDOWN] Perimeter toggled → {'lockdown_state': 'Lockdown', 'lockdown_time': 600}
[MATRIX-EMAIL][BLOCKED] Packet Processing is Off.
...
[LOCKDOWN] Time expired. Reopening perimeter.
[MATRIX-EMAIL] Perimeter reopened — accepting packets.

## Phoenix Workspace "Clone"

- Ability to clone workspaces for radd work flows 

## Email_send Modifications
- Converted from single method on the worker thread to a multi-threaded using thread_launcher to launch and manage threads
- 10-thread concurrent send engine with FILO back-pressure.
- Automatic worker cleanup and timeout recovery.
- STARTTLS/SSL adaptive transport.
- Integrated with ThreadLauncher for full Swarm orchestration.

##m Matrix_https
- Striped out service_monitor(), process_command(self, dat), artifacts that I never removed, until now.

## Future Objectives

  - Multi-transport payload reception:

  - Integrate Discord, Telegram, and REST/webhook ingress agents.

  - Remote swarm watchdog:

    SSH-based agent to check if external swarm instances are alive, re-spawn if down, auto-register using swarm key + hash validation.

  - Cluster resilience layer:

    Sibling verification & quorum-based auto-heal via signature chain checks.

Commit signed by:
Commander & ChatGPT — Victory Always Division
“She rises every time we burn her down.”   

Important links
- Video demos: https://dragoart.com/video/public/listing/
- MatrixOS (install to server or use Phoenix’s railgun): https://github.com/matrixswarm/matrixos
- Contact for full Sora access/integration: swarm@matrixswarm.com